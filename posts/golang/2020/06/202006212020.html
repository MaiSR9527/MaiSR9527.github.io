<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Go Web编程学习一：接受请求 | maiBlog</title><meta name="description" content="Go高效的net&#x2F;http模块"><meta name="keywords" content="GoWeb"><meta name="author" content="maishuren"><meta name="copyright" content="maishuren"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/bitbug-favicon-32x32.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Go Web编程学习一：接受请求"><meta name="twitter:description" content="Go高效的net&#x2F;http模块"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner21.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Go Web编程学习一：接受请求"><meta property="og:url" content="https://www.maishuren.top/posts/golang/2020/06/202006212020.html"><meta property="og:site_name" content="maiBlog"><meta property="og:description" content="Go高效的net&#x2F;http模块"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner21.jpg"><meta property="article:published_time" content="2020-06-21T12:20:07.000Z"><meta property="article:modified_time" content="2021-02-17T09:37:29.540Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://www.maishuren.top/posts/golang/2020/06/202006212020.html"><link rel="prev" title="数据结构与算法：时间复杂度" href="https://www.maishuren.top/posts/datastructure/2020/06/202006230817.html"><link rel="next" title="nginx实践：rewrite规则" href="https://www.maishuren.top/posts/nginx/2020/06/202006211318.html"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0d6717a65ff7b5a1f6c9a03d9d87f2f4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"HLCQW4XQIU","apiKey":"2b769a4e28e86d9b2629a08dec449623","indexName":"myblog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://at.alicdn.com/t/font_1900832_ry85jxoks1.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="maiBlog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/blog/newavatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">70</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">21</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">16</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/playlist/"><i class="fa-fw fa fa-music"></i><span> /歌单</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Go开发web服务器：接收请求"><span class="toc-number">1.</span> <span class="toc-text">Go开发web服务器：接收请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Go的net-http标准库"><span class="toc-number">1.1.</span> <span class="toc-text">Go的net&#x2F;http标准库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用net-http标准库搭建一个简单web服务器"><span class="toc-number">1.2.</span> <span class="toc-text">使用net&#x2F;http标准库搭建一个简单web服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#处理器和处理函数"><span class="toc-number">1.3.</span> <span class="toc-text">处理器和处理函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义Handler处理请求"><span class="toc-number">1.3.1.</span> <span class="toc-text">自定义Handler处理请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用多个Handler来处理不同请求"><span class="toc-number">1.3.2.</span> <span class="toc-text">使用多个Handler来处理不同请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理器函数"><span class="toc-number">1.3.3.</span> <span class="toc-text">处理器函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#串联多个处理器和处理函数"><span class="toc-number">1.3.4.</span> <span class="toc-text">串联多个处理器和处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ServeMux和DefaultServeMux"><span class="toc-number">1.3.5.</span> <span class="toc-text">ServeMux和DefaultServeMux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用其他多路复用器（HttpRouter）"><span class="toc-number">1.3.6.</span> <span class="toc-text">使用其他多路复用器（HttpRouter）</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner21.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">maiBlog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/playlist/"><i class="fa-fw fa fa-music"></i><span> /歌单</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Go Web编程学习一：接受请求</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-21 20:20:07"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-21</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-02-17 17:37:29"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-02-17</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%90%8E%E7%AB%AF/Go/">Go</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.1k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 13 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/posts/golang/2020/06/202006212020.html#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/posts/golang/2020/06/202006212020.html" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Go开发web服务器：接收请求"><a href="#Go开发web服务器：接收请求" class="headerlink" title="Go开发web服务器：接收请求"></a>Go开发web服务器：接收请求</h1><h2 id="Go的net-http标准库"><a href="#Go的net-http标准库" class="headerlink" title="Go的net/http标准库"></a>Go的net/http标准库</h2><ol>
<li>net/http 标准库的各个组成部分：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/go/go-net-http.jpg" alt="go-http"></p>
<ol start="2">
<li>Go服务器的处理请求：</li>
</ol>
<p>在启动了一个http服务器之后，就可以就收客户端发过来的请求，进行处理并相应。<code>net/http</code>标准库还提供了一个连接多路复用器的接口以及一个默认实现了的多路复用器。多路复用器根据客户端的请求路径，找到对应的处理器，处理器就会进行一系列的操作。最后把处理结果通过模板引擎在模板上显示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/go/handle-http.jpg" alt=""></p>
<h2 id="使用net-http标准库搭建一个简单web服务器"><a href="#使用net-http标准库搭建一个简单web服务器" class="headerlink" title="使用net/http标准库搭建一个简单web服务器"></a>使用net/http标准库搭建一个简单web服务器</h2><p>新建一个server.go以下代码。然后运行，在浏览器上访问<a href="http://localhost:8080，浏览器上就会出现一个空白页。至此一个简单地web服务器就这样搭建成功了。对比于Java">http://localhost:8080，浏览器上就会出现一个空白页。至此一个简单地web服务器就这样搭建成功了。对比于Java</a> Web，在搭建的时候还要使用Servlet，然后面向对象，需要写的代码量比Go会多很多。所以说Go比较适合做网络应用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr:    <span class="string">"127.0.0.1:8080"</span>,</span><br><span class="line">		Handler: <span class="literal">nil</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	err := server.ListenAndServe()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于<code>http.Server</code>的详细配置</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义Http服务器的运行参数</span></span><br><span class="line"><span class="comment">// 服务器的零值是有效配置</span></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Addr可以选择以“ host：port”的形式指定服务器侦听的TCP地址。如果为空，则使用“：http”（端口80）</span></span><br><span class="line">	<span class="comment">// 有关地址格式的详细信息，请参见net.Dial</span></span><br><span class="line">	Addr <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用的处理程序，如果为nil，则为http.DefaultServeMux</span></span><br><span class="line">	Handler Handler </span><br><span class="line"></span><br><span class="line">	<span class="comment">// TLSConfig optionally provides a TLS configuration for use</span></span><br><span class="line">	<span class="comment">// by ServeTLS and ListenAndServeTLS. Note that this value is</span></span><br><span class="line">	<span class="comment">// cloned by ServeTLS and ListenAndServeTLS, so it's not</span></span><br><span class="line">	<span class="comment">// possible to modify the configuration with methods like</span></span><br><span class="line">	<span class="comment">// tls.Config.SetSessionTicketKeys. To use</span></span><br><span class="line">	<span class="comment">// SetSessionTicketKeys, use Server.Serve with a TLS Listener</span></span><br><span class="line">	<span class="comment">// instead.</span></span><br><span class="line">	TLSConfig *tls.Config</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ReadTimeout is the maximum duration for reading the entire</span></span><br><span class="line">	<span class="comment">// request, including the body.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Because ReadTimeout does not let Handlers make per-request</span></span><br><span class="line">	<span class="comment">// decisions on each request body's acceptable deadline or</span></span><br><span class="line">	<span class="comment">// upload rate, most users will prefer to use</span></span><br><span class="line">	<span class="comment">// ReadHeaderTimeout. It is valid to use them both.</span></span><br><span class="line">	ReadTimeout time.Duration</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ReadHeaderTimeout is the amount of time allowed to read</span></span><br><span class="line">	<span class="comment">// request headers. The connection's read deadline is reset</span></span><br><span class="line">	<span class="comment">// after reading the headers and the Handler can decide what</span></span><br><span class="line">	<span class="comment">// is considered too slow for the body. If ReadHeaderTimeout</span></span><br><span class="line">	<span class="comment">// is zero, the value of ReadTimeout is used. If both are</span></span><br><span class="line">	<span class="comment">// zero, there is no timeout.</span></span><br><span class="line">	ReadHeaderTimeout time.Duration</span><br><span class="line"></span><br><span class="line">	<span class="comment">// WriteTimeout is the maximum duration before timing out</span></span><br><span class="line">	<span class="comment">// writes of the response. It is reset whenever a new</span></span><br><span class="line">	<span class="comment">// request's header is read. Like ReadTimeout, it does not</span></span><br><span class="line">	<span class="comment">// let Handlers make decisions on a per-request basis.</span></span><br><span class="line">	WriteTimeout time.Duration</span><br><span class="line"></span><br><span class="line">	<span class="comment">// IdleTimeout is the maximum amount of time to wait for the</span></span><br><span class="line">	<span class="comment">// next request when keep-alives are enabled. If IdleTimeout</span></span><br><span class="line">	<span class="comment">// is zero, the value of ReadTimeout is used. If both are</span></span><br><span class="line">	<span class="comment">// zero, there is no timeout.</span></span><br><span class="line">	IdleTimeout time.Duration</span><br><span class="line"></span><br><span class="line">	<span class="comment">// MaxHeaderBytes controls the maximum number of bytes the</span></span><br><span class="line">	<span class="comment">// server will read parsing the request header's keys and</span></span><br><span class="line">	<span class="comment">// values, including the request line. It does not limit the</span></span><br><span class="line">	<span class="comment">// size of the request body.</span></span><br><span class="line">	<span class="comment">// If zero, DefaultMaxHeaderBytes is used.</span></span><br><span class="line">	MaxHeaderBytes <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TLSNextProto optionally specifies a function to take over</span></span><br><span class="line">	<span class="comment">// ownership of the provided TLS connection when an ALPN</span></span><br><span class="line">	<span class="comment">// protocol upgrade has occurred. The map key is the protocol</span></span><br><span class="line">	<span class="comment">// name negotiated. The Handler argument should be used to</span></span><br><span class="line">	<span class="comment">// handle HTTP requests and will initialize the Request's TLS</span></span><br><span class="line">	<span class="comment">// and RemoteAddr if not already set. The connection is</span></span><br><span class="line">	<span class="comment">// automatically closed when the function returns.</span></span><br><span class="line">	<span class="comment">// If TLSNextProto is not nil, HTTP/2 support is not enabled</span></span><br><span class="line">	<span class="comment">// automatically.</span></span><br><span class="line">	TLSNextProto <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="function"><span class="keyword">func</span><span class="params">(*Server, *tls.Conn, Handler)</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ConnState specifies an optional callback function that is</span></span><br><span class="line">	<span class="comment">// called when a client connection changes state. See the</span></span><br><span class="line">	<span class="comment">// ConnState type and associated constants for details.</span></span><br><span class="line">	ConnState <span class="function"><span class="keyword">func</span><span class="params">(net.Conn, ConnState)</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ErrorLog specifies an optional logger for errors accepting</span></span><br><span class="line">	<span class="comment">// connections, unexpected behavior from handlers, and</span></span><br><span class="line">	<span class="comment">// underlying FileSystem errors.</span></span><br><span class="line">	<span class="comment">// If nil, logging is done via the log package's standard logger.</span></span><br><span class="line">	ErrorLog *log.Logger</span><br><span class="line"></span><br><span class="line">	<span class="comment">// BaseContext optionally specifies a function that returns</span></span><br><span class="line">	<span class="comment">// the base context for incoming requests on this server.</span></span><br><span class="line">	<span class="comment">// The provided Listener is the specific Listener that's</span></span><br><span class="line">	<span class="comment">// about to start accepting requests.</span></span><br><span class="line">	<span class="comment">// If BaseContext is nil, the default is context.Background().</span></span><br><span class="line">	<span class="comment">// If non-nil, it must return a non-nil context.</span></span><br><span class="line">	BaseContext <span class="function"><span class="keyword">func</span><span class="params">(net.Listener)</span> <span class="title">context</span>.<span class="title">Context</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ConnContext optionally specifies a function that modifies</span></span><br><span class="line">	<span class="comment">// the context used for a new connection c. The provided ctx</span></span><br><span class="line">	<span class="comment">// is derived from the base context and has a ServerContextKey</span></span><br><span class="line">	<span class="comment">// value.</span></span><br><span class="line">	ConnContext <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, c net.Conn)</span> <span class="title">context</span>.<span class="title">Context</span></span></span><br><span class="line"></span><br><span class="line">	disableKeepAlives <span class="keyword">int32</span>     <span class="comment">// accessed atomically.</span></span><br><span class="line">	inShutdown        <span class="keyword">int32</span>     <span class="comment">// accessed atomically (non-zero means we're in Shutdown)</span></span><br><span class="line">	nextProtoOnce     sync.Once <span class="comment">// guards setupHTTP2_* init</span></span><br><span class="line">	nextProtoErr      error     <span class="comment">// result of http2.ConfigureServer if used</span></span><br><span class="line"></span><br><span class="line">	mu         sync.Mutex</span><br><span class="line">	listeners  <span class="keyword">map</span>[*net.Listener]<span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">	activeConn <span class="keyword">map</span>[*conn]<span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">	doneChan   <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">	onShutdown []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>搭建一个提供https服务的服务器</p>
<ol>
<li><p>生成SSL证书和私钥</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"crypto/rand"</span></span><br><span class="line">	<span class="string">"crypto/rsa"</span></span><br><span class="line">	<span class="string">"crypto/x509"</span></span><br><span class="line">	<span class="string">"crypto/x509/pkix"</span></span><br><span class="line">	<span class="string">"encoding/pem"</span></span><br><span class="line">	<span class="string">"math/big"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	max := <span class="built_in">new</span>(big.Int).Lsh(big.NewInt(<span class="number">1</span>), <span class="number">128</span>)</span><br><span class="line">	serialNumber, _ := rand.Int(rand.Reader, max)</span><br><span class="line">	subject := pkix.Name&#123;</span><br><span class="line">		Organization:       []<span class="keyword">string</span>&#123;<span class="string">"com.msr"</span>&#125;,</span><br><span class="line">		OrganizationalUnit: []<span class="keyword">string</span>&#123;<span class="string">"better"</span>&#125;,</span><br><span class="line">		CommonName:         <span class="string">"go web"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	template := x509.Certificate&#123;</span><br><span class="line">		SerialNumber: serialNumber,</span><br><span class="line">		Subject:      subject,</span><br><span class="line">		NotBefore:    time.Now(),</span><br><span class="line">		NotAfter:     time.Now().Add(<span class="number">365</span> * <span class="number">24</span> * time.Hour),</span><br><span class="line">		KeyUsage:     x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature,</span><br><span class="line">		ExtKeyUsage:  []x509.ExtKeyUsage&#123;x509.ExtKeyUsageServerAuth&#125;,</span><br><span class="line">		IPAddresses:  []net.IP&#123;net.ParseIP(<span class="string">"127.0.0.1"</span>)&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	pk, _ := rsa.GenerateKey(rand.Reader, <span class="number">2048</span>)</span><br><span class="line"></span><br><span class="line">	derBytes, _ := x509.CreateCertificate(rand.Reader, &amp;template, &amp;template, &amp;pk.PublicKey, pk)</span><br><span class="line">	certOut, _ := os.Create(<span class="string">"cert.pem"</span>)</span><br><span class="line">	pem.Encode(certOut, &amp;pem.Block&#123;Type: <span class="string">"CERTIFICATE"</span>, Bytes: derBytes&#125;)</span><br><span class="line">	certOut.Close()</span><br><span class="line"></span><br><span class="line">	keyOut, _ := os.Create(<span class="string">"key.pem"</span>)</span><br><span class="line">	pem.Encode(keyOut, &amp;pem.Block&#123;Type: <span class="string">"RSA PRIVATE KEY"</span>, Bytes: x509.MarshalPKCS1PrivateKey(pk)&#125;)</span><br><span class="line">	keyOut.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用https，启动运行。访问<a href="https://localhost:8080" target="_blank" rel="noopener">https://localhost:8080</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr:    <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span><span class="string">",</span></span><br><span class="line"><span class="string">		Handler: nil,</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	err := server.ListenAndServeTLS("</span>cert.pem<span class="string">", "</span>key.pom<span class="string">")</span></span><br><span class="line"><span class="string">	if err != nil &#123;</span></span><br><span class="line"><span class="string">		fmt.Println(err.Error())</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="处理器和处理函数"><a href="#处理器和处理函数" class="headerlink" title="处理器和处理函数"></a>处理器和处理函数</h2><p><strong>处理器：</strong></p>
<p>Web应用中的处理器除了要接收和处理客户端发来的请求，还需要调用模板引擎，然后由模板引擎生成HTML并把数据填充到要回传到客户端的响应报文中。在<code>net/http</code>库中，一个处理器就是拥有一个ServeHTTP方法，这个方法一个参数是ResponseWriter 接口，而第二个参数则是一个指向Request 结构的指针。换句话说，任何接口只要拥有一个ServeHTTP 方法，并且该方法带有以下签名（signature），那么它就是一个处理器。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServeHTTP(w ResponseWriter, r *Request)</span><br></pre></td></tr></table></figure>

<h3 id="自定义Handler处理请求"><a href="#自定义Handler处理请求" class="headerlink" title="自定义Handler处理请求"></a>自定义Handler处理请求</h3><p>创建了一个处理器并将它与服务器进行了绑定，以此来代替原本正在使用的默认多路复用器。这意味着服务器不会再通过URL匹配来将请求路由至不同的处理器，而是直接使用同一个处理器来处理所有请求，因此无论浏览器访问什么地址，服务器返回的都是同样的<code>Hello World！</code>响应。很显然这不是常用的方法。</p>
<p>这也是我们在Web应用中使用多路复用器的原因：对某些特殊用途的服务器来说，只使用一个处理器也许就可以很好地完成工作了，但是在大部分情况下，我们还是希望服务器可以根据不同的URL请求返回不同的响应，而不是一成不变地只返回一种响应。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyHandler <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MyHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	fmt.Fprintf(w, <span class="string">"Hello World!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	handler := MyHandler&#123;&#125;</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr:    <span class="string">"127.0.0.1:8080"</span>,</span><br><span class="line">		Handler: &amp;handler,</span><br><span class="line">	&#125;</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用多个Handler来处理不同请求"><a href="#使用多个Handler来处理不同请求" class="headerlink" title="使用多个Handler来处理不同请求"></a>使用多个Handler来处理不同请求</h3><p>不在Server结构的Handler字段中指定处理器，而是让服务器使用默认的<code>DefaultServeMux</code>作为处理器，然后通<code>http.Handle</code> 函数将处理器绑定至<code>DefaultServeMux</code>。需要注意的是，虽然Handle 函数来源于http 包，但它实际上是<code>ServeMux</code> 结构的方法：这些函数是为了操作便利而创建的函数，调用它们等同于调用<code>DefaultServeMux</code> 的某个方法。比如说，调用<code>http.Handle</code>实际上就是在调用<code>DefaultServeMux</code>的Handle 方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HelloHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> WorldHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *HelloHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(<span class="string">"hello!!!"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *WorldHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(<span class="string">"world!!!"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	hello := HelloHandler&#123;&#125;</span><br><span class="line">	world := WorldHandler&#123;&#125;</span><br><span class="line"></span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr: <span class="string">"127.0.0.1:8080"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	http.Handle(<span class="string">"/hello"</span>, &amp;hello)</span><br><span class="line">	http.Handle(<span class="string">"/world"</span>, &amp;world)</span><br><span class="line"></span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理器函数"><a href="#处理器函数" class="headerlink" title="处理器函数"></a>处理器函数</h3><p>Go语言拥有一种<code>HandlerFunc</code>函数类型，它可以把一个带有正确签名的函数<code>f</code> 转换成一个带有方法<code>f</code>的Handler </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span>&#123;</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(<span class="string">"hello!!!"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">world</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span>&#123;</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(<span class="string">"hello!!!"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr: <span class="string">"127.0.0.1:8080"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	http.HandleFunc(<span class="string">"/hello"</span>, hello)</span><br><span class="line">	http.HandleFunc(<span class="string">"/world"</span>, world)</span><br><span class="line"></span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Handle 函数将一个处理器绑定至URL的具体方法。<code>HandleFun</code>函数会将函数转换成一个Handler ，并将它与<code>DefaultServeMux</code>进行绑定，以此来简化创建并绑定Handler 的工作。换句话说，处理器函数只不过是创建处理器的一种便利的方法而已。</p>
<h3 id="串联多个处理器和处理函数"><a href="#串联多个处理器和处理函数" class="headerlink" title="串联多个处理器和处理函数"></a>串联多个处理器和处理函数</h3><p>Go语言并不是一门函数式编程语言，但它也拥有一些函数式编程语言的特性，如函数类型、匿名函数和闭包。正如前面的代码所示，在Go语言里面，程序可以将一个函数传递给另一个函数，又或者通过标识符去引用一个具名函数。这意味着，可以将函数<code>f1</code>传递给另一个函数<code>f2</code>，然后在函数<code>f2</code>执行完某些操作之后调用<code>f1</code> 。例如：在每个处理器被调用时，都都记录一下调用日志</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/go/chain-func.jpg" alt=""></p>
<p>代码示例：</p>
<p>log函数返回的是一个匿名的HandlerFunc函数。因为hello 函数就是一个HandlerFunc 类型的函数，所以代码log(hello) 实际上就是将hello 函数发送至log 函数之内，换句话说，这段代码串联起了log函数和hello 函数。protect函数也是如此。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HelloHandler <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h HelloHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	fmt.Fprintf(w, <span class="string">"Hello!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">log</span><span class="params">(h http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		fmt.Fprintf(w,<span class="string">"Handler called - %T\n"</span>, h)</span><br><span class="line">		h.ServeHTTP(w, r)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">protect</span><span class="params">(h http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		<span class="comment">// 假设有一系列操作....</span></span><br><span class="line">		fmt.Fprintf(w,<span class="string">"Handler called - %T\n"</span>, h)</span><br><span class="line">		h.ServeHTTP(w, r)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr: <span class="string">"127.0.0.1:8080"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	hello := HelloHandler&#123;&#125;</span><br><span class="line">	http.Handle(<span class="string">"/hello"</span>, protect(log(hello)))</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ServeMux和DefaultServeMux"><a href="#ServeMux和DefaultServeMux" class="headerlink" title="ServeMux和DefaultServeMux"></a>ServeMux和DefaultServeMux</h3><p>ServeMux是一个HTTP请求多路复用器，它负责接收HTTP请求并根据请求中的URL将请求重定向到正确的处理器</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/go/ServeMux.png" alt=""></p>
<p>ServeMux结构包含一个映射，这个映射会将URL映射到相应的处理器。ServeMux也实现了ServeHTTP方法，所以也是一个处理器。当ServeHTTP方法接收到一个请求的时候，它会在结构的映射里面找出与请求URL最匹配的URL，然后调用对应的处理器的ServeHTTP方法。</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/go/ServeMux2.jpg" alt=""></p>
<p>ServeMux是一个结构体并不是一个接口，所以DefaultServeMux并不是ServeMux的实现。DefaultServeMux是ServeMux的实例。并且所有引入了net/http 标准库的程序都可以使用这个实例。当用户没有为Server结构指定处理器时，服务器就会使用DefaultServeMux作为ServeMux的默认实例。</p>
<p>因为ServeMux也是一个处理器 ，所以用户也可以在有需要的情况下对其实例实施处理器串联。</p>
<p>如果绑定根URL（/ ），那么匹配不成功的URL将会根据URL的层级进行下降，并最终降落在根URL之上。当浏览器访问<code>/random</code>的时候，因为服务器无法找到负责处理这个URL的处理器，所以它会把这个URL交给根URL的处理器处理。例如<code>/hello</code>绑定了处理器，当访问<code>/hello/mike</code>的时候，由于<code>/hello/mike</code>没有绑定处理器，就会降级给<code>/hello</code>的处理器去处理。</p>
<p><strong>最小惊讶原则:</strong></p>
<p>也称最小意外原则，是设计包括软件在内的一切事物的一条通用规则，它指的是我们在<br>进行设计的时候，应该做那些合乎常理的事情，使事物的行为总是显而易见、始终如一并且合乎情理。</p>
<h3 id="使用其他多路复用器（HttpRouter）"><a href="#使用其他多路复用器（HttpRouter）" class="headerlink" title="使用其他多路复用器（HttpRouter）"></a>使用其他多路复用器（HttpRouter）</h3><p>创建一个处理器和多路复用器唯一需要做的就是实现ServeHTTP方法，所以通过创建多路复用器来代替<code>net/http</code>包下的ServeMux是完全可行。</p>
<p>ServeMux 的一个缺陷是无法使用变量实现URL模式匹配。例如：<code>/user/123</code>查询id为123的用户，对于Go原生的ServeMux对URL进行语法分析提取<code>123</code>会比较麻烦，就必须在程序里面进行大量复杂的语法分析，并因此给程序带来额外的复杂度。</p>
<p>HttpRouter文档：<a href="https://github.com/julienschmidt/httprouter。" target="_blank" rel="noopener">https://github.com/julienschmidt/httprouter。</a></p>
<p>简单示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"github.com/julienschmidt/httprouter"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request, p httprouter.Params)</span></span> &#123;</span><br><span class="line">	fmt.Fprintf(w, <span class="string">"hello, %s!\n"</span>, p.ByName(<span class="string">"name"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	mux := httprouter.New()</span><br><span class="line">	mux.GET(<span class="string">"/hello/:name"</span>, hello)</span><br><span class="line"></span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr:    <span class="string">"127.0.0.1:8080"</span>,</span><br><span class="line">		Handler: mux,</span><br><span class="line">	&#125;</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于这些路由比配和变量获取很多的Web框架都有实现。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">maishuren</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.maishuren.top/posts/golang/2020/06/202006212020.html">https://www.maishuren.top/posts/golang/2020/06/202006212020.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.maishuren.top" target="_blank">maiBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/GoWeb/">GoWeb</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner17.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/pay-for-weichat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/datastructure/2020/06/202006230817.html"><img class="prev_cover" src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner5.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">数据结构与算法：时间复杂度</div></div></a></div><div class="next-post pull_right"><a href="/posts/nginx/2020/06/202006211318.html"><img class="next_cover" src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner19.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">nginx实践：rewrite规则</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/post/2020/08/202008222257.html" title="go应用开发框架：beego"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/MaiSR9527/blog-pic/banner/blogbanner17.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-22</div><div class="relatedPosts_title">go应用开发框架：beego</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: '2i3wIjlONBKaR3lajGvjzAFG-gzGzoHsz',
  appKey: 'TeeAbRVflEynyYLIloSk30Xe',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: true,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By maishuren</div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20006741号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/algolia.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>